<!DOCTYPE html>
<html>
<head>
  <title>IoT Automation</title>
  <style>
    body { 
      text-align: center; 
      font-family: Arial, sans-serif; 
      background-color: #f5f5f5; 
      display: flex;
      justify-content: flex-start;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      margin: 0;
    }
    .header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: linear-gradient(135deg, violet, purple);
      width: 100%;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .header img {
      width: 100px;
      height: auto;
      margin-right: 20px;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    .header h1 {
      font-size: 20px;
      margin: 5px 0;
      font-weight: 600;
      color: white;
      text-align: center;
    }

    .grid-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .left-column, .right-column {
      display: grid;
      gap: 20px;
    }
    .left-column {
      grid-template-rows: repeat(6, 1fr);
    }
    .right-column {
      grid-template-rows: repeat(7, 1fr);
    }
    .device { 
      width: 100px; 
      height: 100px; 
      background: grey; 
      border-radius: 10px; 
      position: relative; 
      cursor: pointer;
      overflow: hidden;
    }
    .on { 
      background: black; 
    }
    video { 
      width: 100%; 
      height: 100%; 
      position: absolute; 
      top: 0; 
      left: 0; 
      object-fit: cover;
    }

    @media (max-width: 768px) {
      .grid-container {
        grid-template-columns: 1fr;
      }
      .device {
        width: 80px; 
        height: 80px; 
      }
      .header img {
        width: 120px;
      }
    }

    @media (max-width: 600px) {
      .grid-container {
        grid-template-columns: 1fr;
      }
      .device {
        width: 80px; 
        height: 80px; 
      }
      .header img {
        width: 100px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="download.jpeg" alt="Logo">
    <div>
      <h1>Department of Computer Science and Engineering</h1>
      <h1>Sri Venkateswara College of Engineering</h1>
      <h1>Lab-8 Automation Box</h1>
    </div>
  </div>

  <div class="grid-container">
    <div class="left-column">
      <div class="device" id="device7"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device8"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device9"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device10"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device11"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device12"><video src="video 3.mp4" muted loop></video></div>
    </div>
    <div class="right-column">
      <div class="device" id="device0"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device1"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device2"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device3"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device4"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device5"><video src="video 3.mp4" muted loop></video></div>
      <div class="device" id="device6"><video src="video 3.mp4" muted loop></video></div>
    </div>
  </div>

  <script>
    const ESP32_IP = "http://192.168.41.143"; // Replace with ESP32 local IP

    function toggleRelay(relayId) {
        let device = document.getElementById('device' + relayId);
        let video = device.querySelector('video');
        let isOn = device.classList.contains('on') ? 0 : 1;

        fetch(`${ESP32_IP}/update?relay=${relayId}&state=${isOn}`)
        .then(response => response.text())
        .then(data => {
            console.log("ESP32 Response:", data);
            updateUI(relayId, isOn);
        })
        .catch(error => console.error("Error:", error));
    }

    function updateUI(relayId, state) {
        let device = document.getElementById('device' + relayId);
        let video = device.querySelector('video');

        if (state == 1) {
            device.classList.add('on');
            video.muted = true; // Ensure video can autoplay
            video.play();
        } else {
            device.classList.remove('on');
            video.pause();
            video.currentTime = 0; // Reset video
        }
    }

    function fetchState() {
        fetch(`${ESP32_IP}/status`) 
        .then(response => response.json())
        .then(data => {
            Object.keys(data).forEach(relayId => {
                updateUI(parseInt(relayId), data[relayId]);
            });
        })
        .catch(error => console.error("Error fetching state:", error));
    }

    document.addEventListener("DOMContentLoaded", () => {
        const devices = document.querySelectorAll(".device");
        devices.forEach(device => {
            let relayId = device.id.replace('device', '');
            device.addEventListener("click", () => toggleRelay(relayId));
        });

        setInterval(fetchState, 5000);
    });
  </script>
</body>
</html>
